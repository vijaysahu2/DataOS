tables:
  - name: offerings_on_contracts
    sql: {{ load_sql('offerings_on_contracts') }}
    description: Offerings on contract data.
    public: true

    joins:
      - name: offerings
        relationship: many_to_one
        sql: "{TABLE.offering_id}= {offerings.id}"
    dimensions:    
      - name: offering_id
        type: number
        column: offering_id
        description: "The identifier of the offering associated with the contract."

      - name: contract_id
        type: number
        column: contract_id
        description: "The identifier of the contract associated with the offering."

      - name: assignedat
        type: time
        column: assignedat
        description: "The timestamp indicating when the offering was assigned to the contract."

      - name: offer_value
        type: number
        column: offer_value
        description: "The financial value associated with the offering under the contract."

      - name: unique_id
        type: string
        column: unique_id
        description: "The unique identifier"        
        primary_key: true
        public: true

      - name: offer_cost
        type: number
        column: offer_cost
        description: "The cost incurred for the offering under the contract."

    measures:

      - name: count
        sql: "{TABLE.unique_id}"
        type: count_distinct
        description: "Total number of offerings used by all contracts."

      - name: total_offer_value
        sql: "{TABLE.offer_value}"
        type: sum
        description: "Total value of all offerings on contracts."
      
      - name: total_offer_cost
        sql: "{TABLE.offer_cost}"
        type: sum
        description: "Total cost of all offerings on contracts."

      - name: avg_margin_percentage
        sql: "ROUND(((SUM({TABLE.offer_value}) - SUM({TABLE.offer_cost})) / NULLIF(SUM({TABLE.offer_value}), 0)) * 100, 2)"
        type: number
        description: "Average margin percentage across all offerings."

      - name: avg_offer_value
        sql: "{TABLE.offer_value}"
        type: avg
        description: "Average offer value per offering."

      - name: avg_offer_cost
        sql: "{TABLE.offer_cost}"
        type: avg
        description: "Average offer cost per offering."
      
      - name: min_offer_value
        sql: "{TABLE.offer_value}"
        type: min
        description: "Minimum offer value."
      
      - name: max_offer_value
        sql: "{TABLE.offer_value}"
        type: max
        description: "Maximum offer value."
      
      - name: profit_margin
        sql: "{TABLE.offer_value} - {TABLE.offer_cost}"
        type: sum
        description: "Total profit margin (value - cost)."


