tables:
  - name: contracts
    sql: {{ load_sql('contracts') }}
    description: Contracts data.
    public: true

    joins:
      - name: offerings_on_contracts
        relationship: one_to_many
        sql: "{TABLE.id}= {offerings_on_contracts.contract_id}"

    dimensions:    
      - name: program_name
        type: string
        column: program_name
        description: "The name of the program associated with the contract."

      - name: program_manager
        type: string
        column: program_manager
        description: "The name of the program manager overseeing the contract."

      - name: contract_number
        type: string
        column: contract_number
        description: "The unique identifier or number assigned to the contract."

      - name: status
        type: string
        column: status
        description: "The current status of the contract, such as active, pending, or completed."

      - name: ongoing_support_details
        type: string
        column: ongoing_support_details
        description: "Details regarding ongoing support or maintenance provided under the contract."

      - name: contract_value
        type: number
        column: contract_value
        description: "The total monetary value of the contract."

      - name: customerid
        type: number
        column: customerid
        description: "The identifier of the customer associated with the contract."


      - name: id
        type: number
        column: id
        description: "A unique identifier for the contract record."
        primary_key: true
        public: true

      - name: type
        type: string
        column: type
        description: "The type of contract, such as service agreement, partnership, or project-based."

    measures:
      - name: count
        sql: "{TABLE.id}"
        type: count_distinct
        description: "Total number of contracts."

      - name: total_contract_value
        sql: "{TABLE.contract_value}"
        type: sum
        description: "Total contract value across all contracts."
      
      - name: avg_contract_value
        sql: "{TABLE.contract_value}"
        type: avg
        description: "Average contract value."
      
      - name: min_contract_value
        sql: "{TABLE.contract_value}"
        type: min
        description: "Minimum contract value."
      
      - name: max_contract_value
        sql: "{TABLE.contract_value}"
        type: max
        description: "Maximum contract value."
      
      - name: count_active_contracts
        sql: "CASE WHEN {TABLE.status} = 'Active' THEN {TABLE.id} END"
        type: count_distinct
        description: "Count of active contracts."
      
      - name: count_by_type
        sql: "CASE WHEN {TABLE.type} IS NOT NULL THEN {TABLE.id} END"
        type: count_distinct
        description: "Count of contracts by type."